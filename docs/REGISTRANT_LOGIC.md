# 登记人逻辑说明

用于说明「谁登记的」在系统中的存储、展示及与企业微信人员的对应关系，便于业务查询与对账。

---

## 1. 数据库存储

| 表 | 字段 | 含义 |
|----|------|------|
| **usage_records** | **user_id** | 登记人在本系统用户表的主键（整数，对应 users.id） |
| **users** | id | 用户主键，与 usage_records.user_id 一致 |
| **users** | **real_name** | 登记人姓名（展示用；企业微信首次登录时可能暂存为企微 userid，可在后台用户管理中改为真实姓名） |
| **users** | **wx_userid** | 企业微信用户唯一标识（与企微通讯录、管理后台一致，用于对接企微查询具体人员） |
| **users** | username | 本系统登录名（管理员账号有值；仅企微登录的用户可为空） |

**结论**：每条使用记录只存 **user_id**（数值）；要得到「是谁」需关联 users 表，用 **real_name** 展示姓名、用 **wx_userid** 对应企业微信人员。

---

## 2. 业务使用与查询

- **后台「使用记录」列表**  
  - 列名：**登记人**。  
  - 展示：登记人姓名 + 企业微信 userid（格式：`姓名 · 企业微信userid`），便于一眼看到是谁、并能与企微通讯录对照。

- **使用记录导出（CSV/Excel）**  
  - **登记人**：users.real_name（登记人姓名）。  
  - **企业微信userid**：users.wx_userid（单独一列，便于在 Excel 中与企微通讯录、考勤等对照）。

- **API 返回（GET /api/usage）**  
  - **user_id**：本系统用户 id。  
  - **user_name**：登记人姓名（users.real_name）。  
  - **wecom_userid**：企业微信 userid（有则返回，便于前端或第三方对接企微）。

- **我的记录（H5）**  
  - 仅展示当前登录用户自己的记录，不展示「登记人」列（即本人登记）。

---

## 3. 与企业微信人员对应

- **通过 user_id 查 users 表**得到 **wx_userid**，即为该登记人在**企业微信内的唯一标识**。  
- 在企业微信管理后台、通讯录或通过企微 API，用该 **wx_userid** 可查询到具体人员（姓名、部门等）。  
- 若本系统 **real_name** 仍为首次登录时的 userid，可在后台「用户管理」中编辑该用户的「姓名」为真实姓名，或后续通过企微通讯录接口同步。

---

## 4. 小结

| 需求 | 使用方式 |
|------|----------|
| 看「谁登记的」 | 后台使用记录列「登记人」、导出列「登记人」+「企业微信userid」 |
| 与企微人员对照 | 用导出或 API 中的 **企业微信userid** 在企微通讯录/API 中查询 |
| 按登记人筛选 | 后台使用记录筛选「登记人」对应的是按 user_id 筛选（列表/导出一致） |

逻辑统一为：**存 user_id → 关联 users 得 real_name 与 wx_userid → 列表/导出/API 同时提供姓名与企微 userid，符合实际业务使用和查询**。
