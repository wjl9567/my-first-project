# 验证操作指南（按顺序执行）

按下面步骤在自己环境里跑一遍，打勾通过后再发布生产。

---

## 第 0 步：启动后端

在项目里进入 `backend` 目录，执行：

```bash
cd backend
poetry run python run.py
```

或（若在项目根）：

```bash
cd my-first-project/backend
poetry run python run.py
```

看到类似 `Uvicorn running on http://127.0.0.1:8010` 且无报错即表示启动成功。**保持此窗口不关**，后面都在浏览器里操作。

---

## 第 1 步：环境与入口（约 2 分钟）

| 操作 | 预期 | 你的结果 |
|------|------|----------|
| 浏览器打开 http://127.0.0.1:8010/health | 页面显示 `{"status":"ok"}` | ☐ 通过 |
| 打开 http://127.0.0.1:8010/ | 显示 API 欢迎信息（如「设备扫码登记系统 API 在线」） | ☐ 通过 |
| 打开 http://127.0.0.1:8010/docs | 能打开 Swagger 文档页 | ☐ 通过 |

---

## 第 2 步：后台登录（约 1 分钟）

| 操作 | 预期 | 你的结果 |
|------|------|----------|
| 打开 http://127.0.0.1:8010/admin | 出现登录界面（用户名/密码） | ☐ 通过 |
| 输入错误密码点登录 | 提示错误，无法进入 | ☐ 通过 |
| 输入正确账号密码（.env 里 ADMIN_USERNAME / ADMIN_PASSWORD，默认 admin / admin123）点登录 | 进入后台，看到工作台/设备管理等 | ☐ 通过 |

---

## 第 3 步：H5 登记页（约 5 分钟）

**先在同一浏览器里保持已登录后台**（这样 H5 登记页会共用登录态），再操作下面内容。

| 操作 | 预期 | 你的结果 |
|------|------|----------|
| 新标签页打开 http://127.0.0.1:8010/h5/scan | 页面正常，有「扫一扫」「输入设备编号」 | ☐ 通过 |
| 在后台「设备管理」里新增一台测试设备（编号如 TEST001），记下编号 | 保存成功，列表里能看到 | ☐ 通过 |
| 在登记页地址栏改为 http://127.0.0.1:8010/h5/scan?device_code=TEST001 并回车 | 自动带出设备信息，下方出现「操作类型」和表单 | ☐ 通过 |
| 选「常规使用」，随便填必填项后点「提交登记」 | 提示登记成功，可「继续登记」或「查看我的记录」 | ☐ 通过 |
| （可选）点「扫一扫」，用手机或另一设备展示一张只含文字 TEST001 的二维码，用本页摄像头扫 | 能识别并带出设备、可提交 | ☐ 通过 |
| （可选）访问 http://127.0.0.1:8010/s/TEST001 | 自动跳转到登记页且带出 TEST001 设备 | ☐ 通过 |

---

## 第 4 步：我的记录（约 2 分钟）

| 操作 | 预期 | 你的结果 |
|------|------|----------|
| 打开 http://127.0.0.1:8010/h5/my-records | 能看到刚才的登记记录（或提示登录后看到） | ☐ 通过 |
| 若有「借用」记录，点「归还」 | 变为已归还，按钮变为「已归还」 | ☐ 通过 |
| 若有「维修」记录，点「完成」 | 变为已完成 | ☐ 通过 |
| 底部点「登记」再点「我的记录」 | 两个页面切换正常 | ☐ 通过 |

---

## 第 5 步：后台功能抽查（约 5 分钟）

回到 http://127.0.0.1:8010/admin ，已登录状态下：

| 操作 | 预期 | 你的结果 |
|------|------|----------|
| 看「工作台」 | 设备总数、用户数、记录数、今日/本周/本月登记量有数字且合理 | ☐ 通过 |
| 进入「设备管理」 | 列表能加载，能看到 TEST001 | ☐ 通过 |
| 点某设备的「二维码」 | 弹窗出现二维码，扫码或复制链接可得到带 device_code 的 URL | ☐ 通过 |
| 点「批量导入」→「下载模板」 | 能下载一个 .xlsx 文件 | ☐ 通过 |
| （可选）模板里填一行新设备编号（如 TEST002），保存后点「上传并导入」 | 提示成功导入 1 条，列表里出现 TEST002 | ☐ 通过 |
| 进入「使用记录」 | 能按条件筛选，能看到刚才的登记 | ☐ 通过 |
| 进入「用户管理」 | 列表正常，可新增/编辑用户（可选） | ☐ 通过 |

---

## 第 6 步：生产前配置检查（上线前必做）

若验证都通过，准备发布到生产时，请确认：

| 项目 | 说明 | 你的结果 |
|------|------|----------|
| JWT_SECRET | 设为强随机字符串（≥32 字节），且不是默认的 change-me-in-production | ☐ 已配置 |
| BASE_URL | 改为生产域名（如 https://device.xxx.edu.cn），二维码和回调依赖此配置 | ☐ 已配置 |
| ALLOWED_ADMIN_ORIGINS / ALLOWED_ADMIN_IPS | 若只允许院内访问后台，在此配置 | ☐ 已配置或确认不需 |
| 企业微信 | 若用企微登录，WECOM_* 与生产 BASE_URL 回调地址一致 | ☐ 已核对或未使用 |
| 管理员密码 | 首次上线后用管理员账号登录并修改默认密码 | ☐ 已修改或待上线后改 |

---

## 验证完成之后

- 若上述打勾全部通过 → 可以发布给生产使用。
- 若有未通过项 → 记下序号和现象，修好或确认无影响后再发布。

完整条目可对照 `docs/TEST_CHECKLIST.md`。
