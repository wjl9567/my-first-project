# H5 前端测试与调试说明

用于在本地进行 H5 登记页（扫一扫、输入编号、操作类型、差异化表单、提交等）的功能验证与问题排查。

---

## 一、一键启动并打开 H5 登记页

在项目里打开终端，执行：

```bash
cd backend
poetry run python start_h5_dev.py
```

- 约 2 秒后会自动用默认浏览器打开 **设备使用维护登记** 页面（`/h5/scan`）。
- 若没有自动打开，在浏览器地址栏输入：**http://127.0.0.1:8000/h5/scan**

---

## 二、登录后才能登记（必做）

H5 提交登记需要登录态，否则会提示“请先登录”。

**方式一（推荐，适合本机调试）：**

1. 再开一个浏览器标签页，访问：**http://127.0.0.1:8000/admin**
2. 用管理员账号登录（需在 `backend/.env` 中配置 `ADMIN_USERNAME`、`ADMIN_PASSWORD`）
3. 保持该标签页不关，回到 **登记页** 标签页刷新一下，再操作扫码/输入编号、选操作类型、填表、提交

**方式二：** 若已配置企业微信，可在登记页点「企业微信登录」完成登录。

---

## 三、常用地址（本机）

| 用途         | 地址 |
|--------------|------|
| H5 登记页    | http://127.0.0.1:8000/h5/scan |
| 我的记录     | http://127.0.0.1:8000/h5/my-records |
| 后台管理     | http://127.0.0.1:8000/admin |
| API 文档     | http://127.0.0.1:8000/docs |

---

## 四、前端调试（F12）

1. 在登记页按 **F12** 打开开发者工具。
2. **Console**：看是否有红色报错（如某变量未定义、接口 401/404 等），便于定位“没反应”“提交失败”等问题。
3. **Network**：可筛选 XHR/Fetch，查看 `/api/dict`、`/api/usage/form-schema`、`/api/devices`、`/api/usage` 等请求是否发出、状态码和返回内容。
4. 若 **扫一扫** 没反应：在 Console 看是否有报错；同时确认当前环境是否支持摄像头（HTTPS 或 localhost）、是否已授权摄像头。

---

## 五、仍无法访问时

- 确认终端里已出现类似：`Uvicorn running on http://127.0.0.1:8000`。
- 用浏览器直接访问：http://127.0.0.1:8000/health  
  若显示 `{"status":"ok"}` 说明后端正常，再访问上述 H5 地址。
- 若本机开了 VPN，可先关闭 VPN 再试，或确认 VPN 未拦截对 127.0.0.1 的访问。

按上述步骤即可在本机完成 H5 功能测试与验证调试。
